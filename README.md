# TinyML Customer Feedback Detection on UNIHIKER K10 (ESP32‑S3)

A project that captures live audio on the UNIHIKER K10, classifies customer feedback categories from speech with a quantized CNN generated by Edge Impulse, and visualizes results on both the device TFT and a Tailwind‑styled web dashboard served directly from the board.

This repository includes:
- Complete firmware source code (PlatformIO) under `src/` and the Edge Impulse library under `lib/Speech_Emotion_inferencing/`.
- A detailed development log: dataset preparation, model training, and application development.

## Hardware and software

- Board: UNIHIKER K10 (ESP32‑S3 + ES7243E stereo audio ADC + 240×320 TFT)
- Microphone: On‑board digital mic via I2S (TDM, down‑mixed to mono, 16 kHz)
- Tooling: Edge Impulse Studio (dataset + training + C++ SDK export), PlatformIO (build/flash)

## Quick start

1) Clone and open this repo in VS Code.
2) Configure Wi‑Fi (for web dashboard): set `WIFI_SSID` and `WIFI_PASSWORD` at the top of `src/main.cpp`.

3) Build and upload with PlatformIO.

4) After boot, the TFT shows the assigned IP (also printed to serial). Open that address in a browser to view the Tailwind dashboard.

## Dataset preparation

This project uses Toronto emotional speech set (TESS)
 Dataset for model training (https://www.kaggle.com/datasets/ejlok1/toronto-emotional-speech-set-tess)

In the Studio, MFE was used as the DSP block. Parameters used in our training: window length 25 ms, window stride 10 ms, 20–40 mel bands (project dependent), Hamming window.

## Model training (Edge Impulse)

- Input layer (4,018 features)
- Reshape layer (41 columns)
- 2D conv / pool layer (8 filters, 3 kernel size, 1 layer)
- 2D conv / pool layer (16 filters, 3 kernel size, 1 layer)
- 2D conv / pool layer (32 filters, 3 kernel size, 1 layer)
- 2D conv / pool layer (64 filters, 3 kernel size, 1 layer)
- Flatten layer
- Dropout (rate 0.5)

Export the library via “Deploy → Arduino library” (Edge Impulse), then place it under `lib/Speech_Emotion_inferencing/` (already present here).

## Application development

Key elements live in `src/main.cpp`:

- Audio capture: uses UNIHIKER K10’s codec via I2S. Stereo frames are down‑mixed to mono (left channel) at 16 kHz.
- Feature pipeline: sample buffer passed into Edge Impulse `run_classifier` with MFE features compiled into the library.
- TFT UI: a minimal on‑device dashboard draws a label/score bar chart and shows the board IP along the top.
- Wi‑Fi + Web dashboard:
	- Connects to your AP using `WIFI_SSID`/`WIFI_PASSWORD`.
	- Starts an HTTP server and serves a Tailwind‑styled dashboard at `/`.
	- Provides a JSON endpoint at `/data` exposing: `labels`, `probabilities`, `counts`, `topLabel`, `inferenceCount`, `humanTimestamp`, and `ip`.
	- The web UI refreshes every 1.5 s and animates bars for an “at‑a‑glance” view.

Endpoints:
- `/` – Tailwind HTML dashboard (served from flash/PROGMEM)
- `/data` – JSON snapshot for custom dashboards or external clients

## Building and flashing

Environment is defined in `platformio.ini`:

```ini
[env:unihiker]
platform = https://github.com/DFRobot/platform-unihiker.git
board = unihiker_k10
framework = arduino
lib_extra_dirs = lib
build_flags =
		-DARDUINO_USB_CDC_ON_BOOT=1
		-DARDUINO_USB_MODE=1
		-DModel=None
		-DEIDSP_USE_ESP_DSP=0
```

Typical workflow:

```bash
# build
pio run

# upload (adjust the env if needed)
pio run -t upload

# open serial monitor at 115200 baud
pio device monitor -b 115200
```